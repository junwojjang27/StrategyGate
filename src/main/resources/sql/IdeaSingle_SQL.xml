<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="system.menu.ideaSingle">
	<select id="selectList" parameterType="ideaSingleVO" resultType="ideaSingleVO">
		/*	간단 IDEA+ 조회	system.menu.ideaSingle.selectList */
		SELECT
		A.IDEA_CD,
		A.YEAR,
		A.USER_ID,
		CA.CODE_NM AS CATEGORY,
		A.TITLE,
		A.CONTENT,
		<!--A.STATE,-->
		CB.CODE_NM AS STATE,
		<!--CREATE_DT,-->
		TO_CHAR(A.CREATE_DT, 'YYYY.MM.DD') AS CREATE_DT,
		A.UPDATE_DT,
		A.DELETE_DT,
		A.START_DT,
		A.END_DT,
		A.ATCH_FILE_ID,
		A.IDEA_GBN_CD,
		A.DEGREE,
		A.EVAL_STATE,
		B.USER_NM,
		B.DEPT_NM
		FROM IDEA_INFO A
		LEFT JOIN V_ROLE_USER B
		ON A.USER_ID = B.USER_ID
		<include refid="common.func.getCodeJoin">
			<property name="pYear" value="#{findYear}"/>
			<property name="pCodeGrpId" value="'385'"/>
			<property name="pAlias" value="CA"/>
			<property name="pCompareColumn" value="A.CATEGORY"/>
		</include>
		<include refid="common.func.getCodeJoin">
			<property name="pYear" value="#{findYear}"/>
			<property name="pCodeGrpId" value="'390'"/>
			<property name="pAlias" value="CB"/>
			<property name="pCompareColumn" value="A.STATE"/>
		</include>
		WHERE A.IDEA_GBN_CD ='001'
		<if test='findUseYn != null and findUseYn == "Y"'>
			AND A.DELETE_DT IS NULL
		</if>
		<if test='findUseYn != null and findUseYn == "N"'>
			AND A.DELETE_DT IS NOT NULL
		</if>
		<if test='colName == "title"'>
			AND UPPER(A.TITLE) LIKE  '%' || TRIM(UPPER(#{searchKeyword})) ||'%'
		</if>
		<if test='colName == "userNm"'>
			AND UPPER(B.USER_NM) LIKE  '%' || TRIM(UPPER(#{searchKeyword})) ||'%'
		</if>
		AND A.YEAR = #{findYear}
		<if test='findCategory != null and findCategory != ""'>
			AND A.CATEGORY = #{findCategory}
		</if>
		ORDER BY	A.CREATE_DT DESC



	</select>

	<select id="selectDetail" parameterType="ideaSingleVO" resultType="ideaSingleVO">
		/*	간단 IDEA+ 상세 조회	 	system.menu.ideaSingle.selectDetail	*/
		SELECT
			A.CATEGORY,
			A.TITLE,
			A.CONTENT,
		    A.STATE
		FROM IDEA_INFO A
		WHERE 1=1
		  AND A.IDEA_CD=#{ideaCd}
		  AND A.YEAR=#{findYear}

	</select>


	<update id="deleteIdeaSingle" parameterType="ideaSingleVO">
		/*	간단 IDEA+ 삭제	system.menu.ideaSingle.deleteIdeaSingle	*/
		UPDATE IDEA_INFO A
		SET
		A.DELETE_DT = SYSDATE
		WHERE A.YEAR = #{findYear}
		AND A.IDEA_CD IN
		<foreach collection="keys" item="key" open="(" close=")" separator=",">
			#{key}
		</foreach>
	</update>

	<insert id="insertData" parameterType="ideaSingleVO">
		/*	간단 IDEA+ 저장	system.menu.ideaSingle.insertData	*/
		INSERT INTO IDEA_INFO(
			IDEA_CD,
			YEAR,
			USER_ID,
			CATEGORY,
			TITLE,
			CONTENT,
			STATE,
			CREATE_DT,
			UPDATE_DT,
			DELETE_DT,
			START_DT,
			END_DT,
			ATCH_FILE_ID,
			IDEA_GBN_CD,
			DEGREE,
			EVAL_STATE)

		VALUES (
				   #{ideaCd},
				   #{year},
				   #{userId},
				   #{category},
				   #{title},
				   #{content},
				   '001',
				   SYSDATE,
				   #{updateDt},
				   #{deleteDt},
				   #{startDt},
				   #{endDt},
				   #{atchFileId},
				   '001',
				   #{degree},
				   #{evalState})

	</insert>

	<update id="updateData" parameterType="ideaSingleVO">
		/*	간단 IDEA+ 수정	system.menu.ideaSingle.updateData	*/
		UPDATE IDEA_INFO A
		SET
			A.CATEGORY=#{category},
			A.TITLE=#{title},
			A.CONTENT=#{content},
			A.UPDATE_DT=SYSDATE
		WHERE 1=1
		  AND A.IDEA_CD=#{ideaCd}
		  AND A.YEAR=#{findYear}

	</update>
</mapper>